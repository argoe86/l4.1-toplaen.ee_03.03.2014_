<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3c.org/TR/1999/REC-html401-19991224/loose.dtd">
<!-- saved from url=(0049)https://www.openxades.org/web_sign_demo/sign.html -->
<HTML><HEAD><TITLE>Signing demo</TITLE>
<META content="text/html; charset=utf-8" http-equiv=Content-Type>
<SCRIPT type=text/javascript src="idCard.js"></SCRIPT>

<SCRIPT type=text/javascript>
		
		var certListLocal;

        function setHash(hash) {
            document.getElementById('hashHex').value = hash;
        }

        function getSelectedLanguage() {
            return document.getElementById('pluginLanguage').value;
        }

		function loadPlugin(){

			document.getElementById('error').innerHTML = '';

			try
			{
				loadSigningPlugin(getSelectedLanguage());
				var plugin =  new IdCardPluginHandler(getSelectedLanguage());

				//Seda rida on vaja ainult uue digidocPlugin testimise jaoks
				document.getElementById('version').innerHTML  = plugin.getVersion();
			}
			catch (ex)
			{
				if (ex instanceof IdCardException) {
					document.getElementById('error').innerHTML = '[Veakood: ' + ex.returnCode + '; Viga: ' + ex.message + ']';
				} else {
					document.getElementById('error').innerHTML = ex.message != undefined ? ex.message : ex;
				} 
			}
		}

        function getCert() {

			document.getElementById('error').innerHTML = '';

		    try {
				var selectedCertificate = new IdCardPluginHandler(getSelectedLanguage()).getCertificate();
				document.getElementById('certHex').value = selectedCertificate.cert;
				document.getElementById('certId').value = selectedCertificate.id;
			} catch(ex) {
				if (ex instanceof IdCardException) {
					document.getElementById('error').innerHTML = '[Veakood: ' + ex.returnCode + '; Viga: ' + ex.message + ']';
				} else {
					document.getElementById('error').innerHTML = ex.message != undefined ? ex.message : ex;
				}                
            }
        }

        function sign() {

			document.getElementById('error').innerHTML = '';

            try {
                var signature = 
					new IdCardPluginHandler(getSelectedLanguage()).sign(document.getElementById('certId').value, document.getElementById('hashHex').value);
                showSignature(signature);
            } catch(ex) {
                if (ex instanceof IdCardException) {
					document.getElementById('error').innerHTML = '[Veakood: ' + ex.returnCode + '; Viga: ' + ex.message + ']';
				} else {
					document.getElementById('error').innerHTML = ex.message != undefined ? ex.message : ex;
				} 
            }
        }

        function showSignature(signature) {
			document.getElementById('signatureHex').value = signature;
        }

        </SCRIPT>

<META name=GENERATOR content="MSHTML 8.00.6001.18702"></HEAD>
<BODY onload="loadPlugin();">
<DIV id=pluginLocation></DIV>
<DIV style="COLOR: red" id=error></DIV>
<TABLE border=1 cellPadding=5>
  <TBODY>
  <TR>
    <TH colSpan=2>Veebis digiallkirjastamise protsess (Plug-in version: <span id="version"></span>)*</TH></TR>
  <TR>
    <TD>1</TD>
    <TD>Kasutajale pakutakse veebilehel midagi digiallkirjastamiseks - 
      allkirjastatava dokumendi saab alla laadida. Kasutaja algatab 
      allkirjastamisprotsessi, vajutades näiteks nupule "Allkirjasta"</TD></TR>
  <TR>
    <TD>2</TD>
    <TD>Veebirakendus teeb DigiDocService'ile (DDS) päringu 
      StartSession(allkirjastatav andmefail), algatades DDS sessiooni ja saades 
      tagasi sessionID</TD></TR>
  <TR>
    <TD>3</TD>
    <TD>Veebirakendus saadab kasutajale lehe, kuhu laaditakse 
      allkirjastamismoodul</TD></TR>
  <TR>
    <TD>3.5</TD>
    <TD>Keele valik:
        <select id='pluginLanguage'>
            <option value='' selected='true'>vaikimisi keel</option>
            <option value='est'>eesti</option>
            <option value='eng'>inglise</option>
            <option value='rus'>vene</option>
        </select>
    </TD></TR>
  <TR>
    <TD><B>4<B></B></B></TD>
    <TD><B>Loeme allkirjastamismooduli meetodiga getCertificate() välja 
      allkirjastamissertifikaadi ja saadame tulemuse veebirakendusele</B> 
      <P><A id=getcertlink onclick=getCert() href="sign.html#">Get certificates</A></P>
      <P></P>
      <TABLE>
        <TBODY>
        <TR>
          <TD>Valitud sertifikaat HEX kujul</TD>
          <TD><TEXTAREA id=certHex wrap=hard rows=5 cols=80 name=certHex></TEXTAREA></TD></TR></TBODY></TABLE></TD></TR>
  <TR>
    <TD>5</TD>
    <TD>Veebirakendus teeb DDS'ile päringu 
      PrepareSignature(allkirjastamissertifikaat), DDS tagastab allkirjastatava 
      räsi</TD></TR>
  <TR>
    <TD>6</TD>
    <TD>Veebirakendus saadab kasutajale lehe, kus on allkirjastatav räsi ja 
      kuhu laaditakse allkirjastamismoodul</TD></TR>
  <TR>
    <TD><B>7</B></TD>
    <TD><B>Kutsume allkirjastamismooduli meetodit sign(serdi id, 
      allkirjastatav räsi) ja tagastame leitud allkirja veebirakendusele</B> 
      <P></P>
      <TABLE>
        <TBODY>
        <TR>
          <TD>Sertifikaadi ID</TD>
          <TD><INPUT id=certId type=text></INPUT></TD></TR>
        <TR>
          <TD>Allkirjastatav räsi<BR>(hex kujul; <br>
              <a href="javascript:setHash('FAFA0101FAFA0101FAFA0101FAFA0101FAFA0101')">SHA-1 - 20 baiti</a>,<br>
              <a href="javascript:setHash('bf688a7ca189b1536de55c6e74d6c059ef96b8b6ee4f4f338f18bdf4')">SHA-224 - 28 baiti</a>,<br>
              <a href="javascript:setHash('1c3e17006e570bba9b0c2eae2ad2fc43785435ee70b6438e5b783fcb37886059')">SHA-256 - 32 baiti</a>,<br>
              <a href="javascript:setHash('bfd759b966b2ca1be24a446481ea5ffb7fbb12089d5bf11a104e30641a2b5d7b6668f79489a2f9c87ce38c96e1f718bac3f37626ba50d5f4dfdb8dcaaf9f33e9')">SHA-512 - 64 baiti)</a></TD>
          <TD><TEXTAREA id=hashHex rows=3 cols=80 name=hashHex>FAFA0101FAFA0101FAFA0101FAFA0101FAFA0101</TEXTAREA></TD></TR>
        <TR>
          <TD colSpan=2><A id=signlink onclick=sign() 
            href="sign.html#">Sign</A></TD></TR>
        <TR>
          <TD>Allkiri</TD>
          <TD><TEXTAREA id=signatureHex wrap=hard rows=5 cols=80 name=signatureHex></TEXTAREA></TD></TR></TBODY></TABLE></TD></TR>
  <TR>
    <TD>8</TD>
    <TD>Veebirakendus teeb DDS'ile päringu FinalizeSignature(allkiri), DDS 
      moodustab allkirjastatud konteineri</TD></TR>
  <TR>
    <TD>9</TD>
    <TD>Veebirakendus teeb DDS'ile päringu GetSignedDoc(), küsides 
      allkirjastatud dokumenti (ddoc fail); allkirjastatud fail saadetakse 
      kasutajale allalaadimiseks</TD></TR></TBODY></TABLE>

		* - lihtne stsenaarium, kasutades DigiDocService-it ja eeldust, et allkirjastatakse ainult 1 faili. DigiDocService asemel võib kasutada ka DigiDoc teeke ja korraga võib allkirjastada rohkem kui ühe faili. Täpsem info DigiDocService'i kohta: 
		<a href="http://www.sk.ee/upload/files/DigiDocService_spec_est.pdf">Est</a>&nbsp|&nbsp;<a href="http://www.sk.ee/upload/files/DigiDocService_spec_eng.pdf">Eng</a>
    </body>
</html>